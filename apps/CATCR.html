<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Costa&Ribeiro Ateli√™ ¬∑ Infodose Custo & Pre√ßo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* MOBILE-FIRST VERTICAL HARD-LOCK */
    :root {
      --nebula-grad-a: #f0f;
      --nebula-grad-b: #0ff;
      --kob-bg: #020812;
      --kob-panel: #050d18;
      --kob-ink: #eafcff;
      --kob-muted: #8ac7dd;
      --kob-accent: #00ffd0;
      --kob-accent-soft: rgba(0, 255, 208, 0.16);
      --kob-danger: #ff4b81;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 16px 40px rgba(0, 0, 0, 0.6);
      --shadow-chip: 0 0 0 1px rgba(255, 255, 255, 0.12);
      --gap: 14px;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at top, rgba(240, 0, 255, 0.2), transparent 55%),
        radial-gradient(circle at bottom, rgba(0, 255, 255, 0.18), transparent 55%),
        var(--kob-bg);
      color: var(--kob-ink);
      font-family: var(--font-main);
      -webkit-font-smoothing: antialiased;
    }

    body {
      display: flex;
      justify-content: center;
    }

    .cr-shell {
      width: 100%;
      max-width: 480px;
      padding: 18px 16px 40px;
    }

    .cr-card {
      background:
        linear-gradient(135deg, rgba(240, 0, 255, 0.12), rgba(0, 255, 255, 0.06)),
        var(--kob-panel);
      border-radius: 24px;
      box-shadow: var(--shadow-soft);
      padding: 18px 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .cr-header {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .cr-badge {
      align-self: flex-start;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.24);
      border: 1px solid rgba(255, 255, 255, 0.16);
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--kob-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .cr-badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle, #0ff, #00ffd0);
      box-shadow: 0 0 8px rgba(0, 255, 208, 0.8);
    }

    .cr-title {
      font-size: 20px;
      font-weight: 650;
    }

    .cr-subtitle {
      font-size: 13px;
      color: var(--kob-muted);
      line-height: 1.5;
    }

    /* NAV ENTRE TELAS */
    .cr-tabs {
      display: flex;
      margin-top: 10px;
      background: rgba(2, 8, 18, 0.8);
      border-radius: 999px;
      padding: 3px;
      gap: 4px;
    }

    .cr-tab-btn {
      flex: 1;
      border: none;
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      background: transparent;
      color: var(--kob-muted);
      cursor: pointer;
    }

    .cr-tab-btn.cr-tab-active {
      background: linear-gradient(135deg, #f0f, #0ff);
      color: #020812;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.7);
    }

    .cr-screen {
      margin-top: 10px;
      display: none;
      flex-direction: column;
      gap: 14px;
    }

    .cr-screen.cr-screen-active {
      display: flex;
    }

    .cr-section {
      padding: 12px 10px;
      border-radius: 18px;
      background: rgba(2, 8, 18, 0.66);
      border: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      flex-direction: column;
      gap: var(--gap);
    }

    .cr-section-title {
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--kob-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cr-section-title span {
      font-size: 10px;
    }

    .cr-grid {
      display: flex;
      flex-direction: column;
      gap: var(--gap);
    }

    .cr-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cr-label-line {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      font-size: 12px;
      color: var(--kob-muted);
    }

    .cr-label-main {
      font-weight: 500;
      color: var(--kob-ink);
    }

    .cr-label-hint {
      font-size: 11px;
      opacity: 0.85;
    }

    .cr-input,
    .cr-textarea,
    .cr-select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      padding: 10px 12px;
      font-size: 13px;
      background: rgba(1, 7, 16, 0.92);
      color: var(--kob-ink);
      outline: none;
      box-shadow: var(--shadow-chip);
    }

    .cr-input::placeholder,
    .cr-textarea::placeholder {
      color: rgba(138, 199, 221, 0.75);
    }

    .cr-input:focus,
    .cr-textarea:focus,
    .cr-select:focus {
      border-color: var(--kob-accent);
      box-shadow: 0 0 0 1px rgba(0, 255, 208, 0.4);
    }

    .cr-input[type="number"] {
      -moz-appearance: textfield;
    }

    .cr-input::-webkit-outer-spin-button,
    .cr-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .cr-select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      padding-right: 30px;
      background-image:
        linear-gradient(45deg, transparent 50%, #0ff 50%),
        linear-gradient(135deg, #0ff 50%, transparent 50%);
      background-position:
        calc(100% - 18px) 14px,
        calc(100% - 12px) 14px;
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
    }

    .cr-row-inline {
      display: flex;
      flex-direction: column;
      gap: var(--gap);
    }

    .cr-highlight {
      font-size: 18px;
      font-weight: 650;
      background: linear-gradient(135deg, #0ff, #f0f);
      -webkit-background-clip: text;
      color: transparent;
    }

    .cr-summary-line {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      padding: 4px 0;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
    }

    .cr-summary-line:last-child {
      border-bottom: none;
    }

    .cr-summary-label {
      color: var(--kob-muted);
    }

    .cr-summary-value {
      font-weight: 500;
    }

    .cr-textarea {
      border-radius: 14px;
      min-height: 160px;
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      line-height: 1.45;
    }

    .cr-btn-main {
      width: 100%;
      border-radius: 999px;
      padding: 11px 16px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      outline: none;
      cursor: pointer;
      background:
        radial-gradient(circle at top left, rgba(240, 0, 255, 0.7), transparent 50%),
        radial-gradient(circle at bottom right, rgba(0, 255, 255, 0.7), transparent 50%),
        linear-gradient(135deg, #f0f, #0ff);
      color: #020812;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.8);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 4px;
    }

    .cr-btn-main span.icon {
      font-size: 15px;
    }

    .cr-btn-secondary {
      width: 100%;
      margin-top: 6px;
      border-radius: 999px;
      padding: 9px 14px;
      font-size: 13px;
      font-weight: 500;
      border: 1px solid rgba(0, 255, 208, 0.5);
      background: rgba(2, 8, 18, 0.85);
      color: var(--kob-ink);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .cr-btn-secondary span.icon {
      font-size: 14px;
    }

    .cr-btn-danger {
      background: var(--kob-danger);
      border: none;
      color: #180000;
    }

    .cr-note {
      font-size: 11px;
      color: var(--kob-muted);
      line-height: 1.4;
    }

    .cr-note strong {
      color: var(--kob-ink);
    }

    /* TABELA CAT√ÅLOGO */
    .cr-table-wrap {
      width: 100%;
      overflow-x: auto;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(3, 10, 20, 0.8);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 680px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 12px;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-weight: 700;
      background: rgba(255, 255, 255, 0.04);
      position: sticky;
      top: 0;
      z-index: 1;
    }

    td b {
      font-weight: 650;
    }

    td.cr-actions {
      white-space: nowrap;
    }

    td.cr-actions button {
      width: auto;
      padding: 6px 8px;
      font-size: 11px;
      margin: 0 4px 0 0;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: rgba(0, 0, 0, 0.4);
      color: var(--kob-ink);
      cursor: pointer;
    }

    td.cr-actions button.cr-btn-danger {
      border: none;
    }

    .cr-inline-actions {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 8px;
    }

    @media (min-width: 480px) {
      .cr-inline-actions {
        flex-direction: row;
      }
    }

    @media (min-width: 520px) {
      .cr-card {
        padding: 20px 18px 22px;
      }
    }
  </style>
</head>
<body>
  <div class="cr-shell" id="cr-infodose-costa">
    <div class="cr-card">
      <header class="cr-header">
        <div class="cr-badge">
          <span class="cr-badge-dot"></span>
          Infodose ¬∑ Costa&Ribeiro Ateli√™
        </div>
        <h1 class="cr-title">Calculadora de Custo & Pre√ßo por Pe√ßa</h1>
        <p class="cr-subtitle">
          Pensado para moda autoral: voc√™ preenche os custos por pe√ßa e o app sugere
          pre√ßos m√≠nimos, sugeridos e premium, j√° com resumo <strong>Markdown</strong>
          para registro no Livro Vivo / Infod0x.
        </p>

        <div class="cr-tabs">
          <button class="cr-tab-btn cr-tab-active" data-screen="ficha">Ficha da Pe√ßa</button>
          <button class="cr-tab-btn" data-screen="catalogo">Cat√°logo / Planilha</button>
        </div>
      </header>

      <!-- TELA 1: FICHA -->
      <section id="screen-ficha" class="cr-screen cr-screen-active">
        <!-- DADOS DA PE√áA -->
        <section class="cr-section">
          <div class="cr-section-title">
            <span>‚óè</span> Dados da pe√ßa
          </div>
          <div class="cr-grid">
            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Nome da pe√ßa</span>
                <span class="cr-label-hint">Como sai no cat√°logo</span>
              </div>
              <input
                id="cr-nome-peca"
                class="cr-input"
                type="text"
                placeholder="Ex: Vestido Midi Luna"
              />
            </div>

            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Categoria</span>
                <span class="cr-label-hint">Opcional, s√≥ para organiza√ß√£o</span>
              </div>
              <select id="cr-categoria" class="cr-select">
                <option value="">Selecione (opcional)</option>
                <option value="Blusa">Blusa</option>
                <option value="Camiseta">Camiseta</option>
                <option value="Vestido curto">Vestido curto</option>
                <option value="Vestido longo">Vestido longo</option>
                <option value="Saia">Saia</option>
                <option value="Cal√ßa">Cal√ßa</option>
                <option value="Conjunto">Conjunto</option>
                <option value="Acess√≥rio">Acess√≥rio</option>
                <option value="Outro">Outro</option>
              </select>
            </div>

            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Quantidade do lote (pe√ßas)</span>
                <span class="cr-label-hint">Para ver custo total do lote</span>
              </div>
              <input
                id="cr-qtd-lote"
                class="cr-input"
                type="number"
                step="1"
                min="1"
                value="10"
              />
            </div>
          </div>
        </section>

        <!-- MATERIAL PRINCIPAL -->
        <section class="cr-section">
          <div class="cr-section-title">
            <span>‚óè</span> Material principal (tecido)
          </div>
          <div class="cr-grid">
            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Nome do tecido</span>
                <span class="cr-label-hint">Viscose, linho, malha penteada...</span>
              </div>
              <input
                id="cr-material-nome"
                class="cr-input"
                type="text"
                placeholder="Ex: Viscose premium estampada"
              />
            </div>

            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Quantidade comprada (m)</span>
                <span class="cr-label-hint">Rolo / compra do tecido</span>
              </div>
              <input
                id="cr-material-qtd-total"
                class="cr-input"
                type="number"
                step="0.1"
                placeholder="Ex: 20"
                value="10"
              />
            </div>

            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Valor por metro (R$)</span>
                <span class="cr-label-hint">Custo do fornecedor</span>
              </div>
              <input
                id="cr-material-valor-metro"
                class="cr-input"
                type="number"
                step="0.01"
                placeholder="Ex: 35,90"
                value="35.9"
              />
            </div>

            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Quantidade por pe√ßa (m)</span>
                <span class="cr-label-hint">Quanto vai em cada pe√ßa</span>
              </div>
              <input
                id="cr-material-qtd-peca"
                class="cr-input"
                type="number"
                step="0.01"
                placeholder="Ex: 1,4"
                value="1.4"
              />
            </div>

            <div class="cr-grid">
              <div class="cr-summary-line">
                <span class="cr-summary-label">Valor de material por pe√ßa</span>
                <span id="cr-out-material-por-peca" class="cr-summary-value">R$ 0,00</span>
              </div>
              <div class="cr-summary-line">
                <span class="cr-summary-label">Pe√ßas poss√≠veis com esse tecido (aprox.)</span>
                <span id="cr-out-pecas-possiveis" class="cr-summary-value">0</span>
              </div>
            </div>

            <p class="cr-note">
              Se tiver mais de um tecido, renda ou forro, voc√™ pode somar manualmente
              os valores por pe√ßa depois ou duplicar este app para compor os custos.
            </p>
          </div>
        </section>

        <!-- CUSTOS ADICIONAIS POR PE√áA -->
        <section class="cr-section">
          <div class="cr-section-title">
            <span>‚óè</span> Custos adicionais por pe√ßa
          </div>
          <div class="cr-grid">
            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Custo de produ√ß√£o (costureira)</span>
                <span class="cr-label-hint">Valor pago por pe√ßa</span>
              </div>
              <input
                id="cr-custo-producao"
                class="cr-input"
                type="number"
                step="0.01"
                placeholder="Ex: 40,00"
                value="40"
              />
            </div>

            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Aviamentos por pe√ßa</span>
                <span class="cr-label-hint">Bot√µes, z√≠per, linha, renda...</span>
              </div>
              <input
                id="cr-aviamentos"
                class="cr-input"
                type="number"
                step="0.01"
                placeholder="Ex: 8,50"
                value="8.5"
              />
            </div>

            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Frete / transporte por pe√ßa</span>
                <span class="cr-label-hint">M√©dia (frete do lote √∑ n¬∫ de pe√ßas)</span>
              </div>
              <input
                id="cr-frete"
                class="cr-input"
                type="number"
                step="0.01"
                placeholder="Ex: 4,00"
                value="4"
              />
            </div>

            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Custo de embalagem</span>
                <span class="cr-label-hint">Saquinho, caixa, seda...</span>
              </div>
              <input
                id="cr-embalagem"
                class="cr-input"
                type="number"
                step="0.01"
                placeholder="Ex: 5,00"
                value="5"
              />
            </div>

            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Despesas extras</span>
                <span class="cr-label-hint">Taxas, maquininha, pequeno desperd√≠cio</span>
              </div>
              <input
                id="cr-extras"
                class="cr-input"
                type="number"
                step="0.01"
                placeholder="Ex: 3,00"
                value="3"
              />
            </div>

            <div class="cr-field">
              <div class="cr-label-line">
                <span class="cr-label-main">Custo de etiquetas por pe√ßa</span>
                <span class="cr-label-hint">Marca, composi√ß√£o, tamanho...</span>
              </div>
              <input
                id="cr-etiqueta"
                class="cr-input"
                type="number"
                step="0.01"
                placeholder="Ex: 2,50"
                value="2.5"
              />
            </div>
          </div>
        </section>

        <!-- RESUMO DE CUSTOS -->
        <section class="cr-section">
          <div class="cr-section-title">
            <span>‚óè</span> Resumo de custos
          </div>
          <div class="cr-grid">
            <div class="cr-summary-line">
              <span class="cr-summary-label">Material por pe√ßa</span>
              <span id="cr-out-custo-material" class="cr-summary-value">R$ 0,00</span>
            </div>
            <div class="cr-summary-line">
              <span class="cr-summary-label">Produ√ß√£o (costureira)</span>
              <span id="cr-out-custo-producao" class="cr-summary-value">R$ 0,00</span>
            </div>
            <div class="cr-summary-line">
              <span class="cr-summary-label">Aviamentos</span>
              <span id="cr-out-custo-aviamentos" class="cr-summary-value">R$ 0,00</span>
            </div>
            <div class="cr-summary-line">
              <span class="cr-summary-label">Frete / transporte</span>
              <span id="cr-out-custo-frete" class="cr-summary-value">R$ 0,00</span>
            </div>
            <div class="cr-summary-line">
              <span class="cr-summary-label">Embalagem</span>
              <span id="cr-out-custo-embalagem" class="cr-summary-value">R$ 0,00</span>
            </div>
            <div class="cr-summary-line">
              <span class="cr-summary-label">Etiquetas</span>
              <span id="cr-out-custo-etiqueta" class="cr-summary-value">R$ 0,00</span>
            </div>
            <div class="cr-summary-line">
              <span class="cr-summary-label">Despesas extras</span>
              <span id="cr-out-custo-extras" class="cr-summary-value">R$ 0,00</span>
            </div>
            <div class="cr-summary-line">
              <span class="cr-summary-label"><strong>Custo total por pe√ßa</strong></span>
              <span id="cr-out-custo-total" class="cr-summary-value cr-highlight">R$ 0,00</span>
            </div>
            <div class="cr-summary-line">
              <span class="cr-summary-label">Custo total do lote (aprox.)</span>
              <span id="cr-out-custo-lote" class="cr-summary-value">R$ 0,00</span>
            </div>
          </div>
          <p class="cr-note">
            O custo por pe√ßa considera tudo o que voc√™ preencheu acima.  
            A partir dele, o app sugere tr√™s faixas de pre√ßo para o consumidor final.
          </p>
        </section>

        <!-- SUGEST√ïES DE PRE√áO -->
        <section class="cr-section">
          <div class="cr-section-title">
            <span>‚óè</span> Sugest√µes de pre√ßo para consumidor
          </div>
          <div class="cr-grid">
            <div class="cr-summary-line">
              <span class="cr-summary-label">
                Essencial (x2,2 ¬∑ margem ~54%)
              </span>
              <span id="cr-out-preco-essencial" class="cr-summary-value">R$ 0,00</span>
            </div>
            <div class="cr-summary-line">
              <span class="cr-summary-label">
                Sugerido Infodose (x2,7 ¬∑ margem ~63%)
              </span>
              <span id="cr-out-preco-sugerido" class="cr-summary-value">R$ 0,00</span>
            </div>
            <div class="cr-summary-line">
              <span class="cr-summary-label">
                Premium de cole√ß√£o (x3,2 ¬∑ margem ~69%)
              </span>
              <span id="cr-out-preco-premium" class="cr-summary-value">R$ 0,00</span>
            </div>
          </div>
          <p class="cr-note">
            Esses multiplicadores s√£o um <strong>preset base</strong> para moda autoral
            (baixo volume, cuidado manual, risco criativo).  
            Voc√™ pode usar o Essencial como piso, o Sugerido como padr√£o e o Premium
            para pe√ßas limitadas / cole√ß√µes especiais.
          </p>
        </section>

        <!-- ANOTA√á√ïES -->
        <section class="cr-section">
          <div class="cr-section-title">
            <span>‚óè</span> Anota√ß√µes internas
          </div>
          <div class="cr-grid">
            <textarea
              id="cr-anotacoes"
              class="cr-textarea"
              placeholder="Anota√ß√µes sobre modelagem, grade, ajustes de pre√ßo, feedback de clientes..."
            ></textarea>
          </div>
        </section>

        <!-- MARKDOWN RESUMO + SALVAR -->
        <section class="cr-section">
          <div class="cr-section-title">
            <span>‚óè</span> Resumo em Markdown ¬∑ Livro Vivo / Infod0x
          </div>
          <div class="cr-grid">
            <textarea
              id="cr-markdown"
              class="cr-textarea"
              placeholder="Toque em &quot;Gerar resumo em Markdown&quot; para criar a ficha automaticamente."
            ></textarea>
            <div class="cr-inline-actions">
              <button id="cr-generate" class="cr-btn-main" type="button">
                <span class="icon">‚ö°Ô∏è</span>
                <span>Gerar resumo em Markdown (Infodose)</span>
              </button>
              <button id="cr-copy" class="cr-btn-secondary" type="button">
                <span class="icon">üìã</span> Copiar resumo (Markdown)
              </button>
            </div>
            <button id="cr-save-catalog" class="cr-btn-secondary" type="button">
              <span class="icon">üßµ</span> Salvar pe√ßa no Cat√°logo
            </button>
          </div>
          <p class="cr-note">
            Cada clique em ‚ÄúSalvar pe√ßa no Cat√°logo‚Äù grava a pe√ßa no mini banco de dados local (localStorage).
          </p>
        </section>
      </section>

      <!-- TELA 2: CAT√ÅLOGO -->
      <section id="screen-catalogo" class="cr-screen">
        <section class="cr-section">
          <div class="cr-section-title">
            <span>‚óè</span> Cat√°logo de pe√ßas ¬∑ Mini banco de dados
          </div>
          <p class="cr-note">
            Aqui aparecem todas as pe√ßas salvas pela ficha.  
            Voc√™ pode editar, remover, exportar pra planilha ou imprimir.
          </p>

          <div class="cr-inline-actions">
            <button class="cr-btn-secondary" id="cr-export-csv" type="button">
              <span class="icon">üìÑ</span> Exportar CSV / Planilha
            </button>
            <button class="cr-btn-secondary" id="cr-export-pdf" type="button">
              <span class="icon">üñ®</span> Exportar PDF simples
            </button>
          </div>
        </section>

        <section class="cr-section">
          <div class="cr-table-wrap">
            <table id="cr-tabela-pecas">
              <thead>
                <tr>
                  <th>Pe√ßa</th>
                  <th>Categoria</th>
                  <th>Custo total</th>
                  <th>Essencial</th>
                  <th>Sugerido</th>
                  <th>Premium</th>
                  <th class="cr-actions">A√ß√µes</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <p class="cr-note">
            Os dados ficam salvos apenas neste dispositivo (localStorage).  
            Use o CSV/PDF pra enviar pro contador, pra equipe ou pra guardar backup.
          </p>
        </section>
      </section>

      <p class="cr-note">
        Salve este arquivo como <strong>.html</strong>, abra no navegador e use as duas telas
        pra rodar a cole√ß√£o inteira. Sempre √∫nico, sempre seu. üíö
      </p>
    </div>
  </div>

  <script>
    (function () {
      const MKP_ESSENCIAL = 2.2;
      const MKP_SUGERIDO = 2.7;
      const MKP_PREMIUM  = 3.2;

      const LS_KEY = "cr_infodose_catalogo_v1";
      let pecas = [];

      function loadPecas() {
        try {
          const raw = localStorage.getItem(LS_KEY);
          pecas = raw ? JSON.parse(raw) : [];
        } catch (e) {
          pecas = [];
        }
      }

      function savePecas() {
        localStorage.setItem(LS_KEY, JSON.stringify(pecas));
      }

      function parseNumber(id) {
        const el = document.getElementById(id);
        if (!el) return 0;
        const v = parseFloat(String(el.value).replace(",", "."));
        return isNaN(v) ? 0 : v;
      }

      function formatBR(value) {
        return value.toLocaleString("pt-BR", {
          style: "currency",
          currency: "BRL"
        });
      }

      function collectState() {
        const nomePeca   = (document.getElementById("cr-nome-peca").value || "").trim() || "Pe√ßa Costa&Ribeiro";
        const categoria  = (document.getElementById("cr-categoria").value || "").trim();
        const qtdLote    = parseNumber("cr-qtd-lote") || 0;

        const materialNome      = (document.getElementById("cr-material-nome").value || "").trim() || "Tecido principal";
        const materialQtdTotal  = parseNumber("cr-material-qtd-total");
        const materialValorMet  = parseNumber("cr-material-valor-metro");
        const materialQtdPeca   = parseNumber("cr-material-qtd-peca");

        const custoProducao = parseNumber("cr-custo-producao");
        const aviamentos    = parseNumber("cr-aviamentos");
        const frete         = parseNumber("cr-frete");
        const embalagem     = parseNumber("cr-embalagem");
        const extras        = parseNumber("cr-extras");
        const etiqueta      = parseNumber("cr-etiqueta");

        const materialPorPeca = materialValorMet * materialQtdPeca;
        const pecasPossiveis  = materialQtdPeca > 0 ? Math.floor(materialQtdTotal / materialQtdPeca) : 0;

        const custoTotal =
          materialPorPeca +
          custoProducao +
          aviamentos +
          frete +
          embalagem +
          extras +
          etiqueta;

        const custoLote = qtdLote > 0 ? custoTotal * qtdLote : 0;

        const precoEssencial = custoTotal * MKP_ESSENCIAL;
        const precoSugerido  = custoTotal * MKP_SUGERIDO;
        const precoPremium   = custoTotal * MKP_PREMIUM;

        const anotacoes = (document.getElementById("cr-anotacoes").value || "").trim();

        return {
          nomePeca,
          categoria,
          qtdLote,
          materialNome,
          materialQtdTotal,
          materialValorMet,
          materialQtdPeca,
          materialPorPeca,
          pecasPossiveis,
          custoProducao,
          aviamentos,
          frete,
          embalagem,
          extras,
          etiqueta,
          custoTotal,
          custoLote,
          precoEssencial,
          precoSugerido,
          precoPremium,
          anotacoes
        };
      }

      function updateUI() {
        const s = collectState();

        // Material section
        document.getElementById("cr-out-material-por-peca").textContent =
          formatBR(s.materialPorPeca);
        document.getElementById("cr-out-pecas-possiveis").textContent =
          s.pecasPossiveis.toString();

        // Custo section
        document.getElementById("cr-out-custo-material").textContent   = formatBR(s.materialPorPeca);
        document.getElementById("cr-out-custo-producao").textContent   = formatBR(s.custoProducao);
        document.getElementById("cr-out-custo-aviamentos").textContent = formatBR(s.aviamentos);
        document.getElementById("cr-out-custo-frete").textContent      = formatBR(s.frete);
        document.getElementById("cr-out-custo-embalagem").textContent  = formatBR(s.embalagem);
        document.getElementById("cr-out-custo-etiqueta").textContent   = formatBR(s.etiqueta);
        document.getElementById("cr-out-custo-extras").textContent     = formatBR(s.extras);
        document.getElementById("cr-out-custo-total").textContent      = formatBR(s.custoTotal);
        document.getElementById("cr-out-custo-lote").textContent       = formatBR(s.custoLote);

        // Pre√ßos sugeridos
        document.getElementById("cr-out-preco-essencial").textContent = formatBR(s.precoEssencial);
        document.getElementById("cr-out-preco-sugerido").textContent  = formatBR(s.precoSugerido);
        document.getElementById("cr-out-preco-premium").textContent   = formatBR(s.precoPremium);

        return s;
      }

      function gerarMarkdown() {
        const s = updateUI();

        const titulo = `Costa&Ribeiro Ateli√™ ¬∑ Ficha de Custo ‚Äì ${s.nomePeca}`;

        const categoriaLinha = s.categoria
          ? `Categoria: **${s.categoria}**`
          : "Categoria: (n√£o definida)";

        const tabelaCustos = [
          "| Item | Valor por pe√ßa |",
          "|------|----------------|",
          `| Material principal (${s.materialNome}) | ${formatBR(s.materialPorPeca)} |`,
          `| Produ√ß√£o (costureira) | ${formatBR(s.custoProducao)} |`,
          `| Aviamentos | ${formatBR(s.aviamentos)} |`,
          `| Frete / transporte | ${formatBR(s.frete)} |`,
          `| Embalagem | ${formatBR(s.embalagem)} |`,
          `| Etiquetas | ${formatBR(s.etiqueta)} |`,
          `| Despesas extras | ${formatBR(s.extras)} |`,
          `| **Custo total por pe√ßa** | **${formatBR(s.custoTotal)}** |`
        ].join("\n");

        const resumoLote =
          s.qtdLote > 0
            ? `- Quantidade do lote: **${s.qtdLote}** pe√ßa(s)  
- Custo total aproximado do lote: **${formatBR(s.custoLote)}**`
            : "- Quantidade do lote: a definir\n- Custo total do lote: depende da quantidade";

        const resumoTecido =
          s.pecasPossiveis > 0
            ? `- ${formatBR(s.materialValorMet)} / m  
- Quantidade comprada: **${s.materialQtdTotal.toString().replace(".", ",")} m**  
- Quantidade por pe√ßa: **${s.materialQtdPeca.toString().replace(".", ",")} m**  
- Pe√ßas poss√≠veis com esse tecido: **${s.pecasPossiveis} (aprox.)**`
            : "- Dados de tecido ainda incompletos para estimar quantidade de pe√ßas.";

        const blocoAnotacoes = s.anotacoes
          ? s.anotacoes
          : "_(adicione aqui observa√ß√µes sobre modelagem, grade, varia√ß√µes de cor, etc.)_";

        const md = [
          `# ${titulo}`,
          "",
          "## 1. Identifica√ß√£o da pe√ßa",
          "",
          `- Nome da pe√ßa: **${s.nomePeca}**`,
          `- ${categoriaLinha}`,
          "",
          "::info",
          "Esta ficha foi gerada pelo m√≥dulo **Infodose ‚Äì Costa&Ribeiro** para registrar custo e pre√ßo por pe√ßa.  ",
          "Use como base viva: ajuste, regrave, atualize sempre que a realidade mudar.",
          "::",
          "",
          "## 2. Tecido principal",
          "",
          `- Material: **${s.materialNome}**`,
          resumoTecido,
          "",
          "## 3. Custos por pe√ßa",
          "",
          tabelaCustos,
          "",
          resumoLote,
          "",
          "## 4. Sugest√µes de pre√ßo para o consumidor",
          "",
          "::success",
          `- **Pre√ßo Essencial (x2,2 ¬∑ margem ~54%)**: ${formatBR(s.precoEssencial)}`,
          `- **Pre√ßo Sugerido Infodose (x2,7 ¬∑ margem ~63%)**: ${formatBR(s.precoSugerido)}`,
          `- **Pre√ßo Premium de Cole√ß√£o (x3,2 ¬∑ margem ~69%)**: ${formatBR(s.precoPremium)}`,
          "::",
          "",
          "Use assim:",
          "",
          "- Essencial ‚Üí piso para n√£o vender abaixo do m√≠nimo saud√°vel;",
          "- Sugerido ‚Üí pre√ßo padr√£o de varejo autoral, equilibrando desejo e margem;",
          "- Premium ‚Üí pe√ßas limitadas, cole√ß√µes c√°psula, atendimento ultra personalizado.",
          "",
          "## 5. Coment√°rios e decis√µes de pre√ßo",
          "",
          blocoAnotacoes,
          "",
          "> Documento vivo Infodose ¬∑ ajuste tudo que precisar, quando precisar. Sempre √∫nico, sempre seu."
        ].join("\n");

        document.getElementById("cr-markdown").value = md;
      }

      function copyMarkdown() {
        const ta = document.getElementById("cr-markdown");
        if (!ta || !ta.value.trim()) return;
        ta.select();
        ta.setSelectionRange(0, ta.value.length);
        try {
          document.execCommand("copy");
        } catch (e) {
          console.warn("Falha ao copiar. Selecione e copie manualmente.", e);
        }
      }

      /* --------- CAT√ÅLOGO --------- */

      function salvarNoCatalogo() {
        const s = updateUI();
        const id = "p_" + Date.now();

        const item = {
          id,
          nomePeca: s.nomePeca,
          categoria: s.categoria,
          custoTotal: s.custoTotal,
          precoEssencial: s.precoEssencial,
          precoSugerido: s.precoSugerido,
          precoPremium: s.precoPremium,
          createdAt: new Date().toISOString()
        };

        pecas.push(item);
        savePecas();
        renderTabela();
        alert("Pe√ßa salva no Cat√°logo. Abra a aba Cat√°logo pra visualizar. üßµ");
      }

      function editarPeca(id) {
        const p = pecas.find((x) => x.id === id);
        if (!p) return;

        document.getElementById("cr-nome-peca").value = p.nomePeca;
        document.getElementById("cr-categoria").value = p.categoria || "";

        showScreen("ficha");
        updateUI();
        alert("Pe√ßa carregada na ficha. Ajuste os dados e, se quiser, salve como nova vers√£o.");
      }

      function removerPeca(id) {
        if (!confirm("Remover esta pe√ßa do cat√°logo?")) return;
        pecas = pecas.filter((p) => p.id !== id);
        savePecas();
        renderTabela();
      }

      function renderTabela() {
        const tbody = document.querySelector("#cr-tabela-pecas tbody");
        if (!tbody) return;
        tbody.innerHTML = "";
        pecas.forEach((p) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${p.nomePeca}</td>
            <td>${p.categoria || "-"}</td>
            <td>${formatBR(p.custoTotal)}</td>
            <td>${formatBR(p.precoEssencial)}</td>
            <td><b>${formatBR(p.precoSugerido)}</b></td>
            <td>${formatBR(p.precoPremium)}</td>
            <td class="cr-actions">
              <button type="button" onclick="editarPeca('${p.id}')">Carregar</button>
              <button type="button" class="cr-btn-danger" onclick="removerPeca('${p.id}')">Del</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      function exportCSV() {
        if (!pecas.length) {
          alert("Sem pe√ßas pra exportar.");
          return;
        }
        const header = [
          "Pe√ßa",
          "Categoria",
          "Custo total",
          "Pre√ßo Essencial",
          "Pre√ßo Sugerido",
          "Pre√ßo Premium"
        ];
        const rows = pecas.map((p) => [
          p.nomePeca,
          p.categoria || "",
          p.custoTotal.toFixed(2),
          p.precoEssencial.toFixed(2),
          p.precoSugerido.toFixed(2),
          p.precoPremium.toFixed(2)
        ]);
        const csv = [header, ...rows].map((r) => r.join(";")).join("\n");
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "costa-ribeiro-catalogo.csv";
        a.click();
        URL.revokeObjectURL(url);
      }

     
       

       

      function showScreen(name) {
        const screens = {
          ficha: document.getElementById("screen-ficha"),
          catalogo: document.getElementById("screen-catalogo")
        };
        Object.keys(screens).forEach((k) => {
          if (screens[k]) {
            if (k === name) {
              screens[k].classList.add("cr-screen-active");
            } else {
              screens[k].classList.remove("cr-screen-active");
            }
          }
        });

        document.querySelectorAll(".cr-tab-btn").forEach((btn) => {
          const screen = btn.getAttribute("data-screen");
          if (screen === name) {
            btn.classList.add("cr-tab-active");
          } else {
            btn.classList.remove("cr-tab-active");
          }
        });
      }

      /* Eventos */
      const inputs = document.querySelectorAll(
        "#cr-infodose-costa .cr-input, #cr-infodose-costa .cr-select"
      );
      inputs.forEach((el) => {
        el.addEventListener("input", updateUI);
      });

      document.getElementById("cr-generate")?.addEventListener("click", gerarMarkdown);
      document.getElementById("cr-copy")?.addEventListener("click", copyMarkdown);
      document.getElementById("cr-save-catalog")?.addEventListener("click", salvarNoCatalogo);

      document.getElementById("cr-export-csv")?.addEventListener("click", exportCSV);
      document.getElementById("cr-export-pdf")?.addEventListener("click", exportPDF);

      document.querySelectorAll(".cr-tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const screen = btn.getAttribute("data-screen");
          showScreen(screen);
        });
      });

      /* Expor fun√ß√µes pro onclick da tabela */
      window.editarPeca = editarPeca;
      window.removerPeca = removerPeca;

      loadPecas();
      renderTabela();
      updateUI();
    })();
  </script>
</body>
</html>